const translations = {
    es: {
        "login-title": "Iniciar Sesión",
        "label-usuario": "Nombre, DNI o Correo Electrónico:",
        "label-password": "Contraseña:",
        "login-btn": "Iniciar Sesión",
        "register-button": "Registrar Nuevo Usuario",
        "register-title": "Registrar Nuevo Usuario",
        "label-nombre": "Nombre:",
        "label-dni": "DNI:",
        "label-correo": "Correo Electrónico:",
        "label-fecha-nacimiento": "Fecha de Nacimiento:",
        "label-direccion": "Dirección:",
        "label-codigo-postal": "Código Postal:",
        "label-telefono": "Número de Teléfono:",
        "label-fecha-expedicion": "Fecha de Expedición del Carnet:",
        "label-fecha-caducidad": "Fecha de Caducidad del Carnet:",
        "label-contraseña": "Contraseña:",
        "label-confirmar-contraseña": "Confirmar Contraseña:",
        "register-btn": "Registrar Usuario",
        "back-button": "Volver",
        "language-label": "Idiomas"
    },
    ca: {
        "login-title": "Iniciar Sessió",
        "label-usuario": "Nom, DNI o Correu Electrònic:",
        "label-password": "Contrasenya:",
        "login-btn": "Iniciar Sessió",
        "register-button": "Registrar Nou Usuari",
        "register-title": "Registrar Nou Usuari",
        "label-nombre": "Nom:",
        "label-dni": "DNI:",
        "label-correo": "Correu Electrònic:",
        "label-fecha-nacimiento": "Data de Naixement:",
        "label-direccion": "Direcció:",
        "label-codigo-postal": "Codi Postal:",
        "label-telefono": "Número de Telèfon:",
        "label-fecha-expedicion": "Data d’Expedició del Carnet:",
        "label-fecha-caducidad": "Data de Caducitat del Carnet:",
        "label-contraseña": "Contrasenya:",
        "label-confirmar-contraseña": "Confirmar Contrasenya:",
        "register-btn": "Registrar Usuari",
        "back-button": "Tornar enrere",
        "language-label": "Idiomes"
    },
    en: {
        "login-title": "Log In",
        "label-usuario": "Name, DNI or Email:",
        "label-password": "Password:",
        "login-btn": "Log In",
        "register-button": "Register New User",
        "register-title": "Register New User",
        "label-nombre": "Name:",
        "label-dni": "DNI:",
        "label-correo": "Email Address:",
        "label-fecha-nacimiento": "Date of Birth:",
        "label-direccion": "Address:",
        "label-codigo-postal": "Postal Code:",
        "label-telefono": "Phone Number:",
        "label-fecha-expedicion": "License Issue Date:",
        "label-fecha-caducidad": "License Expiration Date:",
        "label-contraseña": "Password:",
        "label-confirmar-contraseña": "Confirm Password:",
        "register-btn": "Register User",
        "back-button": "Back",
        "language-label": "Languages"
    },
    it: {
        "login-title": "Accedi",
        "label-usuario": "Nome, DNI o Email:",
        "label-password": "Password:",
        "login-btn": "Accedi",
        "register-button": "Registrati come nuovo utente",
        "register-title": "Registrati come nuovo utente",
        "label-nombre": "Nome:",
        "label-dni": "DNI:",
        "label-correo": "Email:",
        "label-fecha-nacimiento": "Data di nascita:",
        "label-direccion": "Indirizzo:",
        "label-codigo-postal": "Codice postale:",
        "label-telefono": "Numero di telefono:",
        "label-fecha-expedicion": "Data di rilascio della patente:",
        "label-fecha-caducidad": "Data di scadenza della patente:",
        "label-contraseña": "Password:",
        "label-confirmar-contraseña": "Conferma password:",
        "register-btn": "Registrati",
        "back-button": "Indietro",
        "language-label": "Lingue"
    },
    fr: {
        "login-title": "Se connecter",
        "label-usuario": "Nom, DNI ou Email:",
        "label-password": "Mot de passe:",
        "login-btn": "Se connecter",
        "register-button": "S'inscrire en tant que nouvel utilisateur",
        "register-title": "S'inscrire en tant que nouvel utilisateur",
        "label-nombre": "Nom:",
        "label-dni": "DNI:",
        "label-correo": "Adresse email:",
        "label-fecha-nacimiento": "Date de naissance:",
        "label-direccion": "Adresse:",
        "label-codigo-postal": "Code postal:",
        "label-telefono": "Numéro de téléphone:",
        "label-fecha-expedicion": "Date de délivrance du permis:",
        "label-fecha-caducidad": "Date d'expiration du permis:",
        "label-contraseña": "Mot de passe:",
        "label-confirmar-contraseña": "Confirmer le mot de passe:",
        "register-btn": "S'inscrire",
        "back-button": "Retour",
        "language-label": "Langues"
    },
    de: {
        "login-title": "Einloggen",
        "label-usuario": "Name, DNI oder E-Mail:",
        "label-password": "Passwort:",
        "login-btn": "Einloggen",
        "register-button": "Neuen Benutzer registrieren",
        "register-title": "Neuen Benutzer registrieren",
        "label-nombre": "Name:",
        "label-dni": "DNI:",
        "label-correo": "E-Mail-Adresse:",
        "label-fecha-nacimiento": "Geburtsdatum:",
        "label-direccion": "Adresse:",
        "label-codigo-postal": "Postleitzahl:",
        "label-telefono": "Telefonnummer:",
        "label-fecha-expedicion": "Ausstellungsdatum des Führerscheins:",
        "label-fecha-caducidad": "Ablaufdatum des Führerscheins:",
        "label-contraseña": "Passwort:",
        "label-confirmar-contraseña": "Passwort bestätigen:",
        "register-btn": "Benutzer registrieren",
        "back-button": "Zurück",
        "language-label": "Sprachen"
    },
    no: {
        "login-title": "Logg Inn",
        "label-usuario": "Navn, DNI eller E-post:",
        "label-password": "Passord:",
        "login-btn": "Logg Inn",
        "register-button": "Registrer Ny Bruker",
        "register-title": "Registrer Ny Bruker",
        "label-nombre": "Navn:",
        "label-dni": "DNI:",
        "label-correo": "E-postadresse:",
        "label-fecha-nacimiento": "Fødselsdato:",
        "label-direccion": "Adresse:",
        "label-codigo-postal": "Postnummer:",
        "label-telefono": "Telefonnummer:",
        "label-fecha-expedicion": "Utstedelsesdato for førerkort:",
        "label-fecha-caducidad": "Utløpsdato for førerkort:",
        "label-contraseña": "Passord:",
        "label-confirmar-contraseña": "Bekreft passord:",
        "register-btn": "Registrer Bruker",
        "back-button": "Tilbake",
        "language-label": "Språk"
    }
};

function changeLanguage(language) {
    const elements = document.querySelectorAll("[id], [name]");

    elements.forEach(element => {
        const id = element.id || element.name;

        if (translations[language][id]) {
            if (element.id || element.name) {
                element.textContent = translations[language][id];
            }
        }
    });
}

document.querySelectorAll("#language-list li").forEach(item => {
    item.addEventListener("click", function () {
        const selectedLang = this.getAttribute("data-lang");
        changeLanguage(selectedLang);
    });
});

changeLanguage("es");

document.getElementById('login-btn').addEventListener('click', async function (event) {
    event.preventDefault();

    const usuario = document.getElementById('usuario').value;
    const password = document.getElementById('password').value;

    const jsonBody = {
        contraseña: password
    };

    if (/^\d{8}[A-Za-z]$/.test(usuario)) {
        jsonBody.dni = usuario;
    } else if (/\S+@\S+\.\S+/.test(usuario)) {
        jsonBody.correo = usuario;
    } else {
        jsonBody.nombre = usuario;
    }

    try {
        const response = await fetch('http://localhost:5000/auth/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(jsonBody)
        });

        const data = await response.json();

        if (response.ok && data.token) {
            localStorage.setItem('token', data.token);
            localStorage.setItem('nombreUsuario', data.nombre);
            localStorage.setItem('userId', data.userId);
            window.location.href = "paginaWeb.html";
        } else {
            alert(data.mensaje || 'Datos incorrectos o usuario no encontrado');
        }
    } catch (error) {
        console.error("Error al conectar con el servidor:", error);
        alert('Hubo un error al intentar iniciar sesión. Inténtalo más tarde.');
    }
});


document.getElementById('register-button').addEventListener('click', function () {
    document.getElementById('login-form').style.display = 'none';
    document.getElementById('register-form').style.display = 'block';
});

document.getElementById('back-button').addEventListener('click', function () {
    document.getElementById('register-form').style.display = 'none';
    document.getElementById('login-form').style.display = 'block';
});

document.getElementById('register-form').addEventListener('submit', function (e) {
    e.preventDefault();

    const nombre = document.getElementById('nombre').value;
    const dni = document.getElementById('dni').value;
    const correo = document.getElementById('correo').value;
    const fechaNacimiento = document.getElementById('fechaNacimiento').value;
    const direccion = document.getElementById('direccion').value;
    const codigoPostal = document.getElementById('codigoPostal').value;
    const telefono = document.getElementById('telefono').value;
    const fechaExpedicion = document.getElementById('fechaExpedicion').value;
    const fechaCaducidad = document.getElementById('fechaCaducidad').value;
    const contraseña = document.getElementById('contraseña').value;
    const confirmarContraseña = document.getElementById('confirmarContraseña').value;

    fetch('/api/registrar', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            nombre,
            dni,
            correo,
            fechaNacimiento,
            direccion,
            codigoPostal,
            telefono,
            fechaExpedicion,
            fechaCaducidad,
            contraseña,
            confirmarContraseña
        })
    })
        .then(response => response.json())
        .then(data => {
            if (data.msg) {
                alert(data.msg);
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
});

document.getElementById('register-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(e.target);
    const data = Object.fromEntries(formData);

    try {
        const response = await fetch('http://localhost:5000/auth/register', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        });

        const result = await response.json();
        if (response.ok) {
            alert('Usuario registrado exitosamente');
        } else {
            alert(result.message || 'Error al registrar el usuario');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Hubo un error al registrar el usuario');
    }
});
